<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    :root {
      --bg-main: #0a0a0a;
      --bg-card: rgba(255, 255, 255, 0.03);
      --border: rgba(255, 255, 255, 0.08);
      --text-main: #ffffff;
      --text-muted: rgba(255, 255, 255, 0.4);
      --accent-emerald: #10b981;
      --accent-amber: #f59e0b;
      --accent-blue: #3b82f6;
      --accent-red: #ef4444;
    }

    body { 
      width: 360px; 
      padding: 0; 
      margin: 0; 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
      background: var(--bg-main); 
      color: var(--text-main);
      overflow-x: hidden;
    }

    .app-container {
      padding: 20px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
    }

    .header h3 {
      margin: 0;
      font-size: 13px;
      font-weight: 900;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-main);
    }

    .section { 
      background: var(--bg-card);
      border: 1px solid var(--border);
      padding: 16px; 
      border-radius: 4px; 
      margin-bottom: 16px; 
    }
    
    label { 
      font-size: 9px; 
      font-weight: 800; 
      color: var(--text-muted); 
      display: block; 
      margin-bottom: 8px; 
      text-transform: uppercase; 
      letter-spacing: 0.1em;
    }

    input, select { 
      width: 100%; 
      padding: 10px 12px; 
      margin-bottom: 14px; 
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--border); 
      border-radius: 2px; 
      box-sizing: border-box; 
      font-size: 12px; 
      color: #fff;
      outline: none;
      transition: all 0.2s;
    }

    input:focus, select:focus {
      border-color: rgba(255,255,255,0.2);
      background: rgba(0,0,0,0.5);
    }

    .btn-main { 
      width: 100%; 
      padding: 14px; 
      cursor: pointer; 
      border-radius: 2px; 
      border: none; 
      font-size: 11px;
      font-weight: 900; 
      margin-bottom: 10px; 
      text-transform: uppercase;
      letter-spacing: 0.1em;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    #toggleBtn { 
      background-color: var(--accent-emerald); 
      color: white;
      box-shadow: 0 4px 14px 0 rgba(16, 185, 129, 0.2);
    }

    #toggleBtn:hover {
      background-color: #059669;
      transform: translateY(-1px);
    }

    #toggleBtn.recording { 
      background-color: var(--accent-red);
      animation: pulse-red 2s infinite;
    }

    @keyframes pulse-red {
      0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
      100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
    }

    #syncBtn { 
      background-color: var(--accent-amber); 
      color: #000; 
    }

    #syncBtn:hover {
      background-color: #d97706;
    }

    #syncBtn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .btn-sub-group { 
      display: grid; 
      grid-template-cols: 1fr 1fr; 
      gap: 10px; 
      margin-bottom: 20px;
    }

    .btn-sub { 
      padding: 10px; 
      font-size: 9px; 
      font-weight: 700;
      cursor: pointer; 
      border-radius: 2px; 
      border: 1px solid var(--border); 
      background: transparent; 
      color: var(--text-muted); 
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: all 0.2s;
    }

    .btn-sub:hover {
      color: #fff;
      border-color: rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.05);
    }
    
    .status-bar {
      padding: 12px;
      background: rgba(0,0,0,0.4);
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 10px;
      font-weight: 700;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    #status { 
      font-weight: 900; 
      color: var(--accent-blue); 
    }

    #status.capturing {
      color: var(--accent-red);
    }

    .log-container { 
      max-height: 180px; 
      overflow-y: auto; 
      padding: 0 20px 20px 20px; 
    }

    .log-container::-webkit-scrollbar {
      width: 4px;
    }
    .log-container::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 10px;
    }

    .log-item { 
      font-size: 10px; 
      border-bottom: 1px solid var(--border); 
      padding: 10px 0; 
      color: rgba(255,255,255,0.6); 
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .log-item .step-prefix {
      width: 25px;
      color: var(--text-muted);
      font-family: 'JetBrains Mono', monospace;
      font-weight: 700;
    }

    .log-item b {
      width: 55px;
      color: var(--accent-blue);
      text-transform: uppercase;
      flex-shrink: 0;
      margin-right: 0;
    }

    .log-item .step-val {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: rgba(255,255,255,0.8);
    }

    .settings-icon {
      color: var(--text-muted);
      transition: color 0.2s;
      padding: 4px;
    }
    .settings-icon:hover { color: #fff; }

    #saveKeyBtn {
      background: var(--accent-blue);
      color: white;
      border: none;
      padding: 10px;
      border-radius: 2px;
      font-size: 10px;
      font-weight: 800;
      text-transform: uppercase;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="header">
      <h3>Recorder Engine</h3>
      <button id="settingsBtn" class="settings-icon" style="background:none; border:none; cursor:pointer;">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
      </button>
    </div>

    <div id="settingsPanel" style="display:none;" class="section animate-in fade-in duration-300">
      <label>Sync Key (Zentest ID)</label>
      <div style="position: relative; width: 100%;">
        <input type="password" id="apiKeyInput" placeholder="Enter Project Key..." style="padding-right: 40px; margin-bottom: 10px;">
        <button id="togglePassword" style="position: absolute; right: 8px; top: 10px; background: none; border: none; cursor: pointer; color: var(--text-muted); padding: 4px; display: flex; align-items: center; justify-content: center;">
          <svg id="eyeIcon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
      </div>
      <button id="saveKeyBtn">Verify & Deploy Link</button>
    </div>

    <div class="section" id="configSection">
      <div id="configToggle" style="display:flex; justify-content:space-between; align-items:center; cursor:pointer; user-select:none;">
        <label style="margin-bottom:0; cursor:pointer;">Environment Configuration</label>
        <svg id="toggleIcon" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="transition: transform 0.3s; color:var(--text-muted);"><path d="m6 9 6 6 6-6"/></svg>
      </div>
      
      <div id="configContent" style="max-height: 500px; overflow: hidden; transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1); margin-top: 16px;">
        <label>Target Environment</label>
        <select id="projectSelect">
            <option value="">-- NO ACTIVE CONTEXT --</option>
        </select>
        
        <label>Module Path (Category)</label>
        <input type="text" id="folderNameInput" placeholder="e.g. Authentication, Billing..." value="General">
        
        <label>Scenario Identifier</label>
        <input type="text" id="scenarioNameInput" placeholder="Scenario name or ID...">
      </div>
    </div>

    <button id="toggleBtn" class="btn-main">Initialize Capture</button>
    <button id="syncBtn" class="btn-main">Deploy to Zentest</button>

    <div class="btn-sub-group">
      <button id="exportBtn" class="btn-sub">Export Manifest</button>
      <button id="clearBtn" class="btn-sub">Purge Local Cache</button>
    </div>
  </div>

  <div class="status-bar">
    <div>Engine State: <span id="status">Standby</span></div>
    <div><span id="stepCount">0</span> NODES CAPTURED</div>
  </div>
  
  <div class="log-container" id="logList"></div>

  <script src="popup.js"></script>
</body>
</html>